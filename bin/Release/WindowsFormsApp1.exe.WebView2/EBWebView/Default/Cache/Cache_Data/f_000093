!function(e,s){e.extend({autoCut:function(s,i,t){if(0==s.length||i>e.getLength(s))return e.htmlencode(s);for(var o="",r=0,a=s.split(""),c=0;c<a.length;c++){var l=a[c];if(r+=s.charCodeAt(c)>=255?2:1,o+=l,r>=i)return t?e.htmlencode(o+t):e.htmlencode(o+"...")}},getLength:function(e){for(var s=0,i="",t=0;t<e.length;t++)i=e.charCodeAt(t),s+=i>=255?2:1;return s}}),s.url={userInfo:_config.host+"home/userInfo",addOrder:"/Financial/ajax-order-addOrder"},s.header={config:{teacherType:!1,url:{home:"/",drive:"#",studio:"/studentStudio/",t_studio:"/teacherstudio/course/teaching",message:"/studentstudio/notice/system?schoolCode="+getQuery("schoolCode"),profile:"/studentstudio/config/info?schoolCode="+getQuery("schoolCode"),profile_teacher:"/teacherstudio/profile/info?schoolCode="+getQuery("schoolCode"),logout:"#",addOrder:"/financial/order/addOrder"},user:{id:"",displayName:"",avatorUrl:""},course:{title:"",totalStudent:0,cellCount:0,learned:0,schedule:0,openYearOrTerm:"",coverUrl:"",teachers:[],_news:""},menu:{_static:[{title:"目录",url:_config.prefix+"process/",key:"process"},{title:"直播课堂",url:_config.prefix+"coach/",key:"coach"},{title:"作业",url:_config.prefix+"assignment/",key:"assignment"},{title:"笔记",url:_config.prefix+"note/",key:"note"},{title:"考核权重",url:_config.prefix+"weight/",key:"weight"}],t_static:[{title:"目录",url:_config.prefix+"process/",key:"process"},{title:"直播课堂",url:_config.prefix+"coach/",key:"coach"},{title:"考核权重",url:_config.prefix+"weight/",key:"weight"}],_dynamic:[]}},template:['<script type="text/html" id="GLOBAL_HEADER">','<div class="header">','    <div class="header-inner clearfix">','        <div class="logo_thumb"><a href="{{url.home}}" title="logo"></a></div>','        <div class="nav">','            <ul class="clearfix">','                <li><a href="{{url.home}}">首&nbsp;&nbsp;页</a></li>','                <li style="display:none;"><a href="{{url.drive}}" class="incomplete">我的网盘</a></li>',"                {{if !isRole}}","                {{if teacherType}}",'                   <li><a href="{{url.t_studio}}?schoolCode={{schoolCode}}" class="current">教师工作室</a></li>',"                {{else}}",'                   <li><a href="{{url.studio}}/?schoolCode={{schoolCode}}" class="current">学习空间</a></li>',"                {{/if}}","                {{/if}}","            </ul>","        </div>",'        <div class="user-info">',"            <ul>",'                <li id="profile_detail">','                    <a href="javascript:void(0);" class="avatar"><img src="{{user.avatorUrl}}"></a>','                    <div class="card-info" style="display:none;">','                        <div class="card-title">','                            <span><img src="{{user.avatorUrl}}"></span>','                            <span style="position: absolute; top: 12px;">{{user.displayName}}</span>','                            <span style="position: absolute; top: 32px;">{{user.schoolName}}</span>',"                        </div>",'                        <div class="card-links" style="display:none;">','                            <a href="{{url.studio}}">我的课程</a>','                            <span class="split"></span>','                            <a href="{{url.drive}}" class="incomplete">我的网盘</a>',"                        </div>","                        {{if user.lastCourse}}",'                        <div class="card-history">','                            <span class="history-item">','                                <span class="split-h"></span>','                                <span class="tit text-ellipsis" title="{{user.lastCourse.courseName}}">{{user.lastCourse.courseName}}</span>','                                <span class="media-name text-ellipsis" title="{{user.lastCourse.cellName}}">{{user.lastCourse.cellName}}</span>','                                <a href="{{user.lastCourse.id | resolveLastCourseUrl:user.lastCourse.courseOpenId }}" class="continue" target="_blank" title="继续学习 {{user.lastCourse.cellName}}">继续</a>',"                            </span>","                        </div>","                        {{/if}}",'                        <div class="card-sets clearfix">',"                           {{if !isRole}}","                          {{if teacherType}}",'                             <a href="{{url.profile_teacher}}" class="pull-left"><i class="iconfont icon-gerenzhongxin"></i>个人设置</a>',"                          {{else}}",'                             <a href="{{url.profile}}" class="pull-left"><i class="iconfont icon-gerenzhongxin"></i>个人设置</a>',"                          {{/if}}","                        {{/if}}",'                            <a href="{{url.logout}}" class="pull-right">退出</a>',"                        </div>","                    </div>","                </li>","            </div>","        </div>","    </div>","</div>","</script>"].join(""),wrapper:['<script type="text/html" id="GLOBAL_WRAPPER">','<div class="wrapper clefix">','    <div class="c-position">我的课程 \\ {{course.title}} ({{course.openYearOrTerm}})</div>',"    {{if !teacherType}}",'    <div class="statusbar-box">','        <div class="statusbar">','            <div class="ad-pic"><img src="{{course.coverUrl}}"></div>','            <div class="number">','                <div class="text">','                    <p class="fs20">{{course.totalStudent}}</p>',"                    <p>学习人数</p>","                </div>","            </div>",'            <div class="number2">','                <div class="text">','                    <p class="fs20">{{course.cellCount}}<span class="fs12">个</span></p>',"                    <p>教学活动总数</p>","                </div>","            </div>",'            <div class="time">','                 <div class="text">','                     <p class="fs20">{{course.learned}}<span class="fs12">个</span></p>',"                     <p>已学教学活动</p>","                 </div>","            </div>",'            <div class="start 1">',"                 {{if course.NoBuy}}",'                <a href="javascript:void(0)" id="buy_course" data-courseid="{{course.courseOpenId}}" data-coursename="{{course.title}}" data-coursemoney="{{course.money}}"><div class="pay"><p>{{course.money}}元</p> <p>立即支付</p> </div></a>',"                 {{else}}  ",'               <a href="{{course.lastLearned | resolveLastLearnedUrl }}" target="_blank" title="{{if course.isFirstTime }}开始学习{{else}}继续学习{{/if}}">{{if course.isFirstTime }}开始学习{{else}}继续学习{{/if}}</a>',"                {{/if}}  ","            </div>","        </div>",'        <div class="progress">','            <div class="progress-bar" style="width: {{course.schedule}}%;" ></div>',"        </div>",'        <div class="progress-tips top" style="left:{{course.schedule - 3}}%;">','            <div class="progress-tips-arrow"></div>','            <div class="progress-tips-inner">',"                <span>学习完成度</span>","                <sapn>{{course.schedule}}%</sapn>","            </div>","        </div>","    </div>","    {{/if}}",'    <div class="clefix">',"       {{if !teacherType}}",'           <div class="content">',"       {{/if}}","            {{if teacherType}}",'            <div class="t-content">','               <div class="statusbar-box">','                   <div class="statusbar">','                       <div class="ad-pic"><img src="{{course.coverUrl}}"></div>','                       <div class="number">','                           <div class="text">','                               <p class="fs20">{{course.totalStudent}}</p>',"                               <p>学习人数</p>","                           </div>","                       </div>",'                       <div class="number2">','                           <div class="text">','                               <p class="fs20">{{course.cellCount}}<span class="fs12">个</span></p>',"                               <p>教学活动总数</p>","                           </div>","                       </div>","                   </div>","               </div>","            {{/if}}",'            <div class="notice">','                 <span><i class="iconfont icon-notice"></i>课程公告：</span>','                 <a href="javascript:void(0);" class="notice-info">{{course._news}}</a>',"             </div>",'            <div class="content-inner" >','                <ul class="course-menu clefix">',"                {{if teacherType}}","                    {{each menu.t_static as item i}}",'                        <li><a href="{{item.url | combineUrl}}" class="{{if item.active}}current{{/if}}">{{item.title}}</a></li>',"                    {{/each}}","                {{else}}","                    {{each menu._static as item i}}",'                        <li><a href="{{item.url | combineUrl}}" class="{{if item.active}}current{{/if}}">{{item.title}}</a></li>',"                    {{/each}}","                {{/if}}","                {{if menu._dynamic.length > 0}}",'                 <li id="custom_menu">','                     <a href="javascript:void(0);" id="customModule"><span>学习文件</span> <i class="iconfont icon-xiasanjiao ml5"></i></a>','                     <ul class="dp-menu" >',"                         {{each menu._dynamic as item i}}",'                             <li><a href="{{item.id | combineUrl2}}">{{item.title}}</a></li>',"                         {{/each}}","                     </ul>","                 </li>","                {{/if}}","                </ul>",'                <div class="content-info" id="container_content">',"                </div>","            </div>","        </div>",'        <div class="sidebar" >','            <div class="sidebar-bg" id="container_teacher">',"                <h2>授课教师</h2>",'                <ul class="teacher-box">',"                {{each course.teachers as item i}}",'                    <li class="clefix">','                        <div class="teacher">','                            <img src="{{item.avatorUrl}}">','                            <div class="teacher-radius"></div>',"                        </div>","                        <h3>{{item.displayName}}</h3>","                        <em>{{item.jobTitle}}</em>","                    </li>","                {{/each}}","                </ul>","            </div>",'            <div class="sidebar-bg" id="container_resource" style="height:388px; position:relative;">','               <h2><a href="javascript:void(0);" data-tips="tips" data-direction="top" title="换一换" class="btn_reload_resource"><i class="iconfont icon-shuaxin2"></i></a>相关资源</h2>','               <div class="mask-layer">','                    <div class="x-loading"></div>',"                </div>","            </div>",'            <div class="sidebar-bg" id="container_course" style="height:388px; position:relative;">','               <h2><a href="javascript:void(0);" data-tips="tips" data-direction="top" title="换一换" class="btn_reload_resource"><i class="iconfont icon-shuaxin2"></i></a>推荐课程</h2>','               <div class="mask-layer">','                    <div class="x-loading"></div>',"                </div>","            </div>",'            <div class="sidebar-bg" id="container_students" style="height:388px; position:relative;">','               <h2><a href="javascript:void(0);" data-tips="tips" data-direction="top" title="换一换" class="btn_reload_students"><i class="iconfont icon-shuaxin2"></i></a><em>……</em>位在学习该课程</h2>','               <div class="mask-layer">','                    <div class="x-loading"></div>',"                </div>","            </div>","        </div>","    </div>","</div>","</script>"].join(""),error:function(){window.history.go(-1)},action:function(i,t){var o=this,r=getQuery("schoolCode");e.ajax({async:!1,url:s.url.userInfo,data:{courseOpenId:i,projectId:t,schoolCode:r},dataType:"JSON",type:"GET"}).done(function(s){if(!handleException(s))return!1;if(o.config.teacherType=s.teacherType,o.config.isRole=s.isRole,o.config.user.id=s.userId,o.config.user.displayName=s.displayName,o.config.user.schoolCode=s.schoolCode,o.config.course.openYearOrTerm=s.openYearOrTerm,o.config.user.avatorUrl=s.avatorUrl||"../../images/no_photo_180.png",o.config.url.logout=s.logoutUrl,o.config.course.NoBuy=s.currentCourse.NoBuy,o.config.course.money=s.currentCourse.money,s.lastCourse.id&&(o.config.user.lastCourse=s.lastCourse),o.config.user.schoolName=s.schoolName,o.config.course.courseOpenId=s.courseOpenId,o.config.course.title=s.currentCourse.title,o.config.course.coverUrl=s.currentCourse.coverUrl||"../../images/kcfm-pic.jpg",o.config.course.totalStudent=s.currentCourse.totalStudent,o.config.course.cellCount=s.currentCourse.cellCount,o.config.course.schedule=s.currentCourse.schedule||0,o.config.course.learned=s.currentCourse.learned,o.config.course._news=s.currentCourse._news||"暂无公告",o.config.course.lastLearned=s.currentCourse.lastLearned,o.config.course.isFirstTime=s.currentCourse.isFirstTime,o.config.course.teachers=[],o.config.schoolCode=r,o.config.teacherType){var i=e("<link>");i.attr("rel","stylesheet").attr("href","../../css/t-studio.css"),e("head").append(i)}e.each(s.currentCourse.teachers,function(e,s){o.config.course.teachers.push({displayName:s.displayName,avatorUrl:s.avatorUrl||"../../images/no_photo_180.png",jobTitle:s.jobTitle||"教师"})}),e.each(s.currentCourse.customs,function(e,s){o.config.menu._dynamic.push({id:s.id,title:s.title,url:_config.prefix+"custom/",key:"custom"})});var t=o.config.menu[s.teacherType?"t_static":"_static"];e.each(t,function(e,s){if(window.location.pathname.indexOf(s.key)!=-1)return s.active=!0,document.title=o.config.user.schoolName+""+s.title,!1}),e("body").prepend(template("GLOBAL_WRAPPER",o.config)),e("body").prepend(template("GLOBAL_HEADER",o.config)),e("#profile_detail").hover(function(){e(this).find(".card-info").show()},function(){e(this).find(".card-info").hide()}),e(".incomplete").on("click",function(){return alert("暂未开发，敬请期待。"),!1}),e("#custom_menu").hover(function(){e(this).find("ul").show()},function(){e(this).find("ul").hide()}),e(".progress-bar").hover(function(){e(".progress-tips").stop(!0,!0).fadeIn()},function(){e(".progress-tips").stop(!0,!0).fadeOut()}),lazy_include({jsFiles:[{url:"http://tj.ahjxjy.cn:2345/socket.io/socket.io.js",cb:function(){e("body").append('<script src="http://tj.ahjxjy.cn:2345/boot.js?'+s._socket_string+'"></script>')}}],cssFiles:[]})}),this.event()},event:function(){e("#buy_course").click(function(){var i=e(this),t=i.data("courseid"),o=i.data("coursename"),r=i.data("coursemoney"),a="",c=getQuery("schoolCode"),l=new RegExp("(^|&)projectId=([^&]*)(&|$)"),n=window.location.search.substr(1).match(l);null!=n&&(a=unescape(n[2]));var d="<div class='pay-box'><p>"+o+"</p><p>￥"+r+"元</p></div>",u=!0;dialog=$M({title:"购买课程",lock:!0,fixed:!0,content:d,width:"300px",height:"150px",top:"40%",left:"50%",okVal:"去支付",ok:function(){if(u){u=!1;var i=[];i.push(t),e.post(s.url.addOrder,{courseOpenIds:i,projectid:a,schoolCode:c},function(e){return e.code<0?(alert(e.msg),!1):void(r>0?location.href="/financial/html/content/pay/?orderNumber="+e.orderNumber+"&schoolCode="+c:location.reload())},"json")}},cancel:"取消",close:function(){e("body").css({overflow:"auto"})}})})},init:function(){var s=getQuery("courseOpenId");if(!s)return this.error(),!1;var i=getQuery("projectId"),t=getQuery("schoolCode");e("body").append(this.template),e("body").append(this.wrapper),template.helper("combineUrl",function(e){return e+"?courseOpenId="+s+"&schoolCode="+t}),template.helper("combineUrl2",function(e){return _config.prefix+"custom/?courseOpenId="+s+"&customId="+e+"&schoolCode="+getQuery("schoolCode")}),template.helper("htmlencode",function(s){return e.htmlencode(s)}),template.helper("resolveLastLearnedUrl",function(e){return _config.prefix+"studying/?courseOpenId="+s+"&cellId="+e+"&schoolCode="+getQuery("schoolCode")}),template.helper("resolveLastCourseUrl",function(e,s){return _config.prefix+"studying/?courseOpenId="+s+"&cellId="+e+"&schoolCode="+getQuery("schoolCode")}),this.action(s,i)}},s.header.init()}(jQuery,window.app={});